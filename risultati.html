<script>
    // Aggiungi una colonna per la verifica
    function addTestColumn(date, subject, grades) {
        // Aggiunge la data e la materia nel header con la "X" rossa
        const headerCell = document.createElement('th');
        headerCell.innerHTML = `${date} - ${subject} <span class="delete-column">X</span>`;
        tableHeader.appendChild(headerCell);

        // Aggiunge una cella per ogni studente
        Array.from(tableBody.children).forEach(row => {
            const cell = document.createElement('td');
            const studentName = row.firstElementChild.textContent;
            if (grades && grades[studentName] !== undefined) {
                cell.textContent = grades[studentName];
                if (grades[studentName] === 'ass') {
                    cell.classList.add('grade-absent');
                } else if (grades[studentName] === 'eson') {
                    cell.classList.add('grade-exempt');
                } else if (grades[studentName] >= 10 && grades[studentName] <= 59) {
                    cell.classList.add('grade-red');
                } else if (grades[studentName] >= 60 && grades[studentName] <= 100) {
                    cell.classList.add('grade-black');
                }
            } else {
                cell.textContent = '-';
            }
            cell.classList.add('editable');
            cell.addEventListener('click', function() {
                enableEditMode(cell, grades ? grades[studentName] : '');
            });
            row.appendChild(cell);
        });

        // Gestisce la cancellazione della colonna
        headerCell.querySelector('.delete-column').addEventListener('click', function() {
            const index = Array.from(tableHeader.children).indexOf(headerCell) - 1; // -1 per escludere la colonna Studente
            tableHeader.removeChild(headerCell);
            Array.from(tableBody.children).forEach(row => {
                row.removeChild(row.children[index + 1]); // +1 per escludere la colonna "Studente"
            });

            // Rimuove il test salvato in locale
            tests[currentClass].splice(index, 1);
            localStorage.setItem('tests', JSON.stringify(tests));
        });
    }
</script>
